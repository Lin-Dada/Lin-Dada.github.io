I"µ3<blockquote>
  <p>æœ€è¿‘ä¸€é—¨è¯¾è¦æ±‚åšå¤§ä½œä¸šï¼Œé¢˜ç›®æ˜¯ä¸€ä¸ªæ–‡ä»¶å®‰å…¨ä¼ è¾“ç³»ç»Ÿï¼Œæ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹æœ‰socketã€sslè¯ä¹¦ç”³è¯·ã€ä½¿ç”¨sslè¯ä¹¦åŠ å¯†é€šä¿¡ã€GUIã€å¤šçº¿ç¨‹ç­‰ï¼Œè¿˜æ˜¯è›®å¤šå†…å®¹çš„ã€‚æˆ‘èŠ±äº†ä¸‰å››å¤©åšäº†ä¸ªç®€å•çš„Demoï¼Œä¸­é—´é‡åˆ°äº†è®¸å¤šé—®é¢˜ï¼Œä½†æœ€åè¿˜æ˜¯ä¸€ä¸€è§£å†³äº†ã€‚åé¢æˆ‘ä¼šå°†å®Œæ•´ä»£ç æ”¾åˆ°æˆ‘çš„githubä¸Šï¼Œæœ¬æ–‡è®°å½•äº†æ ¸å¿ƒåŠŸèƒ½çš„å®ç°æ€è·¯ã€‚</p>
</blockquote>

<h3 id="opensslç”³è¯·è¯ä¹¦">OpenSSLç”³è¯·è¯ä¹¦</h3>
<p>æ³¨æ„ä¸‰ç‚¹</p>
<ul>
  <li>
    <p>ç¬¬ä¸€ç‚¹ï¼Œæ³¨æ„å°†å…¶ä¸­çš„ç§é’¥åŠ å¯†å¯†ç ï¼ˆ-passoutå‚æ•°ï¼‰ä¿®æ”¹æˆè‡ªå·±çš„å¯†ç ï¼›ä¸‹è¾¹éƒ½æ˜¯ä»¥å¸¦-passoutå‚æ•°ç”Ÿæˆç§é’¥ï¼Œå¦‚æœä½¿ç”¨-nodeså‚æ•°ï¼Œåˆ™æœ€åä¸€æ­¥â€œå°†åŠ å¯†çš„RSAå¯†é’¥è½¬æˆæœªåŠ å¯†çš„RSAå¯†é’¥â€ä¸éœ€è¦æ‰§è¡Œã€‚</p>
  </li>
  <li>
    <p>ç¬¬äºŒç‚¹ï¼Œè¯ä¹¦å’Œå¯†é’¥ç»™å‡ºäº†ç›´æ¥ä¸€æ­¥ç”Ÿæˆå’Œåˆ†æ­¥ç”Ÿæˆä¸¤ç§å½¢å¼ï¼Œä¸¤ç§å½¢å¼æ˜¯ç­‰ä»·çš„ï¼Œè¿™é‡Œä½¿ç”¨ç›´æ¥ç”Ÿæˆå½¢å¼ï¼ˆåˆ†æ­¥ç”Ÿæˆå½¢å¼è¢«æ³¨é‡Šï¼‰</p>
  </li>
  <li>
    <p>ç¬¬ä¸‰ç‚¹ï¼Œæ³¨æ„å°†å…¶ä¸­çš„è¯ä¹¦ä¿¡æ¯æ”¹æˆè‡ªå·±çš„ç»„ç»‡ä¿¡æ¯çš„ã€‚å…¶ä¸­è¯æ•°å„å‚æ•°å«ä¹‰å¦‚ä¸‹ï¼š</p>
  </li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>C-----å›½å®¶ï¼ˆCountry Nameï¼‰

ST----çœä»½ï¼ˆState or Province Nameï¼‰

L----åŸå¸‚ï¼ˆLocality Nameï¼‰

O----å…¬å¸ï¼ˆOrganization Nameï¼‰

OU----éƒ¨é—¨ï¼ˆOrganizational Unit Nameï¼‰

CN----äº§å“åï¼ˆCommon Nameï¼‰

emailAddress----é‚®ç®±ï¼ˆEmail Addressï¼‰
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre># CAè¯ä¹¦åŠå¯†é’¥ç”Ÿæˆæ–¹æ³•ä¸€----ç›´æ¥ç”ŸæˆCAå¯†é’¥åŠå…¶è‡ªç­¾åè¯ä¹¦
openssl req -newkey rsa:2048 -nodes -keyout ca_rsa_private.pem -x509 -days 365 -out ca.crt -subj "/C=CN/ST=GD/L=SZ/O=COM/OU=NSP/CN=CA/emailAddress=173213354@qq.com"

# æœåŠ¡å™¨è¯ä¹¦åŠå¯†é’¥ç”Ÿæˆæ–¹æ³•ä¸€----ç›´æ¥ç”ŸæˆæœåŠ¡å™¨å¯†é’¥åŠå¾…ç­¾åè¯ä¹¦
openssl req -newkey rsa:2048 -nodes -keyout server_rsa_private.pem  -out server.csr -subj "/C=CN/ST=GD/L=SZ/O=COM/OU=NSP/CN=SERVER/emailAddress=173213354@qq.com"

# ä½¿ç”¨CAè¯ä¹¦åŠå¯†é’¥å¯¹æœåŠ¡å™¨è¯ä¹¦è¿›è¡Œç­¾åï¼š
openssl x509 -req -days 365 -in server.csr -CA ca.crt -CAkey ca_rsa_private.pem -CAcreateserial -out server.crt

# å®¢æˆ·ç«¯è¯ä¹¦åŠå¯†é’¥ç”Ÿæˆæ–¹æ³•ä¸€----ç›´æ¥ç”Ÿæˆå®¢æˆ·ç«¯å¯†é’¥åŠå¾…ç­¾åè¯ä¹¦
openssl req -newkey rsa:2048 -nodes -keyout client_rsa_private.pem -out client.csr -subj "/C=CN/ST=GD/L=SZ/O=COM/OU=NSP/CN=CLIENT/emailAddress=173213354@qq.com"

# ä½¿ç”¨CAè¯ä¹¦åŠå¯†é’¥å¯¹å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œç­¾åï¼š
openssl x509 -req -days 365 -in client.csr -CA ca.crt -CAkey ca_rsa_private.pem -CAcreateserial -out client.crt
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="pythonä¸­å®ç°åŒå‘éªŒè¯">Pythonä¸­å®ç°åŒå‘éªŒè¯</h3>

<p>æˆ‘æ‰¾äº†å¥½ä¹…ç½‘ä¸Šçš„èµ„æ–™ï¼Œç»å¤§éƒ¨åˆ†ä»£ç éƒ½åªå®ç°äº†å•å‘éªŒè¯ï¼Œå³åªéªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦ï¼Œè€Œä¸éªŒè¯å®¢æˆ·ç«¯çš„è¯ä¹¦ã€‚æŸ¥äº†å¥½ä¹…èµ„æ–™ï¼Œç»ˆäºå‘ç°åŒå‘éªŒè¯çš„æ–¹æ³•ï¼Œä¸€è¡Œä»£ç çš„äº‹ï¼Œå³æ‰“å¼€åŒå‘æ ¡éªŒæ¨¡å¼ã€‚</p>

<h4 id="æœåŠ¡å™¨ç«¯æ ¸å¿ƒä»£ç ">æœåŠ¡å™¨ç«¯ï¼šï¼ˆæ ¸å¿ƒä»£ç ï¼‰</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">ssl</span><span class="p">,</span> <span class="n">threading</span><span class="p">,</span> <span class="n">struct</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">pymysql</span>

<span class="k">class</span> <span class="nc">server_ssl</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">server_listen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ç”ŸæˆSSLä¸Šä¸‹æ–‡
</span>        <span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLContext</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">PROTOCOL_TLS_SERVER</span><span class="p">)</span>
        <span class="c1"># åŠ è½½ä¿¡ä»»æ ¹è¯ä¹¦
</span>        <span class="n">context</span><span class="o">.</span><span class="n">load_verify_locations</span><span class="p">(</span><span class="s">'./cer/CA/ca.crt'</span><span class="p">)</span>
        <span class="c1"># åŠ è½½æœåŠ¡å™¨æ‰€ç”¨è¯ä¹¦å’Œç§é’¥
</span>        <span class="n">context</span><span class="o">.</span><span class="n">load_cert_chain</span><span class="p">(</span><span class="s">'./cer/server/server.crt'</span><span class="p">,</span> <span class="s">'./cer/server/server_rsa_private.pem'</span><span class="p">)</span>
        <span class="c1"># åŒå‘æ ¡éªŒæ¨¡å¼
</span>        <span class="n">context</span><span class="o">.</span><span class="n">verify_mode</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_REQUIRED</span>

        <span class="c1"># ç›‘å¬ç«¯å£
</span>        <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">as</span> <span class="n">sock</span><span class="p">:</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s">'127.0.0.1'</span><span class="p">,</span> <span class="mi">9999</span><span class="p">))</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="c1"># å°†socketæ‰“åŒ…æˆSSL socket
</span>            <span class="k">with</span> <span class="n">context</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">server_side</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssock</span><span class="p">:</span>
                <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="c1"># æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥
</span>                    <span class="n">connection</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">ssock</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">'Connected by '</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
                    <span class="c1">#å¼€å¯å¤šçº¿ç¨‹,è¿™é‡Œargåé¢ä¸€å®šè¦è·Ÿé€—å·ï¼Œå¦åˆ™æŠ¥é”™
</span>                    <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn_thread</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">connection</span><span class="p">,))</span>
                    <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">conn_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">connection</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1">#è¿™é‡Œå†™ä½ çš„æœåŠ¡å™¨é€»è¾‘
</span>                <span class="o">...</span>
                <span class="o">...</span>
                
            <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="nb">ConnectionResetError</span><span class="p">:</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">break</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="å®¢æˆ·ç«¯æ ¸å¿ƒä»£ç ">å®¢æˆ·ç«¯ï¼ˆæ ¸å¿ƒä»£ç ï¼‰ï¼š</h4>

<p>å®¢æˆ·ç«¯è¿˜è¦å®ç°å›¾åƒç•Œé¢ï¼Œè¿™é‡Œä½¿ç”¨pythonçš„tkinteråº“å®ç°ï¼ŒGUIçš„ç»†èŠ‚å°±ä¸å¤šè®²äº†,socketä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">ssl</span><span class="p">,</span><span class="n">time</span><span class="p">,</span><span class="n">os</span><span class="p">,</span><span class="n">struct</span><span class="p">,</span><span class="n">json</span><span class="p">,</span><span class="n">tkinter</span>

<span class="k">class</span> <span class="nc">client_ssl</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ç”ŸæˆSSLä¸Šä¸‹æ–‡
</span>        <span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLContext</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">PROTOCOL_TLS_CLIENT</span><span class="p">)</span>
        <span class="c1"># åŠ è½½ä¿¡ä»»æ ¹è¯ä¹¦
</span>        <span class="n">context</span><span class="o">.</span><span class="n">load_verify_locations</span><span class="p">(</span><span class="s">'./cer/CA/ca.crt'</span><span class="p">)</span>
        <span class="c1"># åŠ è½½å®¢æˆ·ç«¯æ‰€ç”¨è¯ä¹¦å’Œç§é’¥
</span>        <span class="n">context</span><span class="o">.</span><span class="n">load_cert_chain</span><span class="p">(</span><span class="s">'./cer/client/client.crt'</span><span class="p">,</span> <span class="s">'./cer/client/client_rsa_private.pem'</span><span class="p">)</span>
        <span class="c1"># åŒå‘æ ¡éªŒæ¨¡å¼
</span>        <span class="n">context</span><span class="o">.</span><span class="n">verify_mode</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_REQUIRED</span>

        <span class="c1"># ä¸æœåŠ¡ç«¯å»ºç«‹socketè¿æ¥
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">((</span><span class="s">'127.0.0.1'</span><span class="p">,</span> <span class="mi">9999</span><span class="p">))</span>

        <span class="c1"># å°†socketæ‰“åŒ…æˆSSL socket
</span>        <span class="c1"># ä¸€å®šè¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„server_hostnameæ˜¯æŒ‡æœåŠ¡ç«¯è¯ä¹¦ä¸­è®¾ç½®çš„CN
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">ssock</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="n">server_hostname</span><span class="o">=</span><span class="s">'SERVER'</span><span class="p">,</span> <span class="n">server_side</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        
    <span class="c1">#ä¸‹é¢å¼€å§‹å®šä¹‰ä½ è‡ªå·±çš„å®¢æˆ·ç«¯é€»è¾‘å‡½æ•°
</span>    <span class="k">def</span> <span class="err">...
</span></pre></td></tr></tbody></table></code></pre></div></div>

:ET