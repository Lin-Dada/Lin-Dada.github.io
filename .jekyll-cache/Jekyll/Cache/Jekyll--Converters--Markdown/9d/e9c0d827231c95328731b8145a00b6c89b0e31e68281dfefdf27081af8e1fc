I"à<h3 id="opensslç”³è¯·è¯ä¹¦">OpenSSLç”³è¯·è¯ä¹¦</h3>
<p>æ³¨æ„ä¸‰ç‚¹</p>

<ul>
  <li>
    <p>ç¬¬ä¸€ç‚¹ï¼Œæ³¨æ„å°†å…¶ä¸­çš„ç§é’¥åŠ å¯†å¯†ç ï¼ˆ-passoutå‚æ•°ï¼‰ä¿®æ”¹æˆè‡ªå·±çš„å¯†ç ï¼›ä¸‹è¾¹éƒ½æ˜¯ä»¥å¸¦-passoutå‚æ•°ç”Ÿæˆç§é’¥ï¼Œå¦‚æœä½¿ç”¨-nodeså‚æ•°ï¼Œåˆ™æœ€åä¸€æ­¥â€œå°†åŠ å¯†çš„RSAå¯†é’¥è½¬æˆæœªåŠ å¯†çš„RSAå¯†é’¥â€ä¸éœ€è¦æ‰§è¡Œã€‚</p>
  </li>
  <li>
    <p>ç¬¬äºŒç‚¹ï¼Œè¯ä¹¦å’Œå¯†é’¥ç»™å‡ºäº†ç›´æ¥ä¸€æ­¥ç”Ÿæˆå’Œåˆ†æ­¥ç”Ÿæˆä¸¤ç§å½¢å¼ï¼Œä¸¤ç§å½¢å¼æ˜¯ç­‰ä»·çš„ï¼Œè¿™é‡Œä½¿ç”¨ç›´æ¥ç”Ÿæˆå½¢å¼ï¼ˆåˆ†æ­¥ç”Ÿæˆå½¢å¼è¢«æ³¨é‡Šï¼‰</p>
  </li>
  <li>
    <p>ç¬¬ä¸‰ç‚¹ï¼Œæ³¨æ„å°†å…¶ä¸­çš„è¯ä¹¦ä¿¡æ¯æ”¹æˆè‡ªå·±çš„ç»„ç»‡ä¿¡æ¯çš„ã€‚å…¶ä¸­è¯æ•°å„å‚æ•°å«ä¹‰å¦‚ä¸‹ï¼š</p>
  </li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>C-----å›½å®¶ï¼ˆCountry Nameï¼‰

ST----çœä»½ï¼ˆState or Province Nameï¼‰

L----åŸå¸‚ï¼ˆLocality Nameï¼‰

O----å…¬å¸ï¼ˆOrganization Nameï¼‰

OU----éƒ¨é—¨ï¼ˆOrganizational Unit Nameï¼‰

CN----äº§å“åï¼ˆCommon Nameï¼‰

emailAddress----é‚®ç®±ï¼ˆEmail Addressï¼‰
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre># CAè¯ä¹¦åŠå¯†é’¥ç”Ÿæˆæ–¹æ³•ä¸€----ç›´æ¥ç”ŸæˆCAå¯†é’¥åŠå…¶è‡ªç­¾åè¯ä¹¦
openssl req -newkey rsa:2048 -nodes -keyout ca_rsa_private.pem -x509 -days 365 -out ca.crt -subj "/C=CN/ST=GD/L=SZ/O=COM/OU=NSP/CN=CA/emailAddress=173213354@qq.com"

# æœåŠ¡å™¨è¯ä¹¦åŠå¯†é’¥ç”Ÿæˆæ–¹æ³•ä¸€----ç›´æ¥ç”ŸæˆæœåŠ¡å™¨å¯†é’¥åŠå¾…ç­¾åè¯ä¹¦
openssl req -newkey rsa:2048 -nodes -keyout server_rsa_private.pem  -out server.csr -subj "/C=CN/ST=GD/L=SZ/O=COM/OU=NSP/CN=SERVER/emailAddress=173213354@qq.com"

# ä½¿ç”¨CAè¯ä¹¦åŠå¯†é’¥å¯¹æœåŠ¡å™¨è¯ä¹¦è¿›è¡Œç­¾åï¼š
openssl x509 -req -days 365 -in server.csr -CA ca.crt -CAkey ca_rsa_private.pem -CAcreateserial -out server.crt

# å®¢æˆ·ç«¯è¯ä¹¦åŠå¯†é’¥ç”Ÿæˆæ–¹æ³•ä¸€----ç›´æ¥ç”Ÿæˆå®¢æˆ·ç«¯å¯†é’¥åŠå¾…ç­¾åè¯ä¹¦
openssl req -newkey rsa:2048 -nodes -keyout client_rsa_private.pem -out client.csr -subj "/C=CN/ST=GD/L=SZ/O=COM/OU=NSP/CN=CLIENT/emailAddress=173213354@qq.com"

# ä½¿ç”¨CAè¯ä¹¦åŠå¯†é’¥å¯¹å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œç­¾åï¼š
openssl x509 -req -days 365 -in client.csr -CA ca.crt -CAkey ca_rsa_private.pem -CAcreateserial -out client.crt
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="pythonä¸­å®ç°åŒå‘éªŒè¯">Pythonä¸­å®ç°åŒå‘éªŒè¯</h3>

<p>æœåŠ¡å™¨ç«¯ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">ssl</span><span class="p">,</span> <span class="n">threading</span><span class="p">,</span> <span class="n">struct</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">pymysql</span>

<span class="k">class</span> <span class="nc">server_ssl</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">server_listen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ç”ŸæˆSSLä¸Šä¸‹æ–‡
</span>        <span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLContext</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">PROTOCOL_TLS_SERVER</span><span class="p">)</span>
        <span class="c1"># åŠ è½½ä¿¡ä»»æ ¹è¯ä¹¦
</span>        <span class="n">context</span><span class="o">.</span><span class="n">load_verify_locations</span><span class="p">(</span><span class="s">'./cer/CA/ca.crt'</span><span class="p">)</span>
        <span class="c1"># åŠ è½½æœåŠ¡å™¨æ‰€ç”¨è¯ä¹¦å’Œç§é’¥
</span>        <span class="n">context</span><span class="o">.</span><span class="n">load_cert_chain</span><span class="p">(</span><span class="s">'./cer/server/server.crt'</span><span class="p">,</span> <span class="s">'./cer/server/server_rsa_private.pem'</span><span class="p">)</span>
        <span class="c1"># åŒå‘æ ¡éªŒæ¨¡å¼
</span>        <span class="n">context</span><span class="o">.</span><span class="n">verify_mode</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_REQUIRED</span>

        <span class="c1"># ç›‘å¬ç«¯å£
</span>        <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">as</span> <span class="n">sock</span><span class="p">:</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s">'127.0.0.1'</span><span class="p">,</span> <span class="mi">9999</span><span class="p">))</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="c1"># å°†socketæ‰“åŒ…æˆSSL socket
</span>            <span class="k">with</span> <span class="n">context</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">server_side</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssock</span><span class="p">:</span>
                <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="c1"># æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥
</span>                    <span class="n">connection</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">ssock</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">'Connected by '</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
                    <span class="c1">#å¼€å¯å¤šçº¿ç¨‹,è¿™é‡Œargåé¢ä¸€å®šè¦è·Ÿé€—å·ï¼Œå¦åˆ™æŠ¥é”™
</span>                    <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conn_thread</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">connection</span><span class="p">,))</span>
                    <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

:ET